import{Q as D}from"./QColor.4a999a30.js";import{Q as T}from"./QMenu.b9a8767e.js";import{_ as P,av as z,r as v,aR as L,c as F,w as A,T as R,o as N,a as U,b as e,e as l,Q as h,aS as j,ax as B,j as Q,as as M,ap as _,aT as E,l as $,ay as H,az as O,ar as p}from"./index.f603e444.js";import{Q as G}from"./QToolbar.158d6054.js";import{Q as K,a as W,b as x}from"./QFab.13fa20d6.js";import{Q as J}from"./QTooltip.8d1993a0.js";import{Q as X}from"./QPageSticky.118496c4.js";import{C as Y}from"./ClosePopup.06611898.js";import{u as Z}from"./useShared.1eaddee4.js";import{S as ee}from"./signature_pad.b2981795.js";import{u as ae}from"./useArchivo.a1848793.js";import{u as oe}from"./use-quasar.7736967f.js";import"./QResizeObserver.fe5a1657.js";import"./selection.1946e002.js";import"./position-engine.71c32519.js";import"./QItem.6e91d9d5.js";const te={setup(){const a=oe();a.loading.show();const{userInfo:n}=z(),{getPlantilla:b,uploadPlantilla:o,uploadSharedPlantilla:y}=Z(),{saveImageSignature:S}=ae(),r=v("Sin t\xEDtulo"),w=v(null);let s=v("");const V=L(),C=v(!1);let q;const k=F(()=>V.params.id);return A(k,async(t,i)=>{if(!t)return;const{msg:d,ok:u}=await b(t);u?s.value=d.contenido:s.value="<h4>No se encontr\xF3 plantilla con el Id, crea una nueva</h4>"}),R(async()=>{const{msg:t,ok:i}=await b(k.value);a.loading.hide(),i?s.value=t.contenido:s.value="<h4>No se encontr\xF3 plantilla con el Id, crea una nueva</h4>"}),{titledoc:r,alert:C,pdf:async()=>{const t=s.value;var i={margin:[15,15],filename:"pdfFileName.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:1,letterRendering:!0,useCORS:!0},jsPDF:{unit:"pt",format:"letter",orientation:"portrait"},pagebreak:{mode:["avoid-all","css","legacy","whiteline"]}};await html2pdf().from(t).set(i).save()},hex:w,qeditor:s,escogerColor(){document.queryCommandEnabled("foreColor")?(document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,w.value)):console.log("El navegador no admite cambiar el color del texto seleccionado.")},showDialog:()=>{C.value=!0,setTimeout(()=>{const t=document.querySelector(".canvas-signature");console.log(t),q=new ee(t)},100)},sendImageSignature:()=>{function t(i){for(var d=i.split(";base64,"),u=d[0].split(":")[1],f=window.atob(d[1]),g=f.length,c=new Uint8Array(g),m=0;m<g;++m)c[m]=f.charCodeAt(m);return new Blob([c],{type:u})}setTimeout(async()=>{const i=q.toDataURL();var d=t(i);console.log(i,"signature");const{msg:u,ok:f}=await S(n.value.uid,d);if(f){const g=s.value,c=document.createElement("div");c.innerHTML=g,c.querySelector(".contenedor-firma").insertAdjacentHTML("beforeend",`
            <div class="columna" style="margin-top: 5px; display: flex; flex-direction: column; align-items: center;">
              <p style="margin-bottom: 2px; font-weight: bold;">OneLoop </p>
              <p style="font-style: oblique; margin-top: 2px;">Creative Designer</p>
              <img src="${u.urlImage}"
                width="100px"
                height="100px"
                alt="falta firmar"
                style="border-bottom: 1px solid black;"
                >
                <p style="margin-top: 2px;">Firma</p>
            </div>
          `),s.value=c.innerHTML}},100)},sendandSavePlantilla:async()=>{if(s.value){const t="firma",i=s.value,d=r.value;await y(d,n.value.uid,n.value.email,t,i)}}}}},I=a=>(H("data-v-75c20bc1"),a=a(),O(),a),ne={class:"q-pa-md"},le=I(()=>p("div",{class:"text-h6"},"Firmar el documento",-1)),ie=I(()=>p("div",{id:"signature-pad",class:"signature-pad"},[p("div",{class:"signature-pad--body row justify-center"},[p("canvas",{class:"canvas-signature bg-deep-purple-2",width:"300",height:"200"})]),p("div",{class:"signature-pad--footer"})],-1));function re(a,n,b,o,y,S){return N(),U("div",ne,[e(G,{class:"bg-indigo-1 text-white"},{default:l(()=>[e(h,{size:"0.8rem",color:"orange-5"},{default:l(()=>[e(T,null,{default:l(()=>[e(D,{modelValue:o.hex,"onUpdate:modelValue":n[0]||(n[0]=r=>o.hex=r),"no-footer":"","no-header":"",onClick:o.escogerColor},null,8,["modelValue","onClick"])]),_:1})]),_:1}),e(B,{dense:"",outlined:"",modelValue:o.titledoc,"onUpdate:modelValue":n[1]||(n[1]=r=>o.titledoc=r),label:"T\xEDtulo del Documento",class:"q-ml-md q-my-xs"},null,8,["modelValue"])]),_:1}),e(K,{id:"editor",modelValue:o.qeditor,"onUpdate:modelValue":n[2]||(n[2]=r=>o.qeditor=r),dense:a.$q.screen.lt.md,"toolbar-bg":"indigo-1",toolbar:[[{label:a.$q.lang.editor.align,icon:a.$q.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]},{label:a.$q.lang.editor.align,icon:a.$q.iconSet.editor.align,fixedLabel:!0,options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:a.$q.lang.editor.formatting,icon:a.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:a.$q.lang.editor.fontSize,icon:a.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:a.$q.lang.editor.defaultFont,icon:a.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}},null,8,["modelValue","dense","toolbar"]),e(h,{class:"q-mt-md",color:"red-13",label:"Descargar en pdf",size:"sm",onClick:o.pdf},null,8,["onClick"]),e(X,{position:"bottom-right",offset:[30,18]},{default:l(()=>[e(W,{icon:"keyboard_arrow_up",direction:"up",color:"red-13"},{default:l(()=>[e(x,{onClick:o.showDialog,color:"teal-5",icon:"edit",label:"firmar"},null,8,["onClick"]),e(x,{onClick:o.sendandSavePlantilla,color:"teal-5",icon:"mail",label:"compartir"},null,8,["onClick"])]),_:1}),e(J,{anchor:"center left",self:"center right"},{default:l(()=>[Q(" Desplegar ")]),_:1})]),_:1}),e(j,{modelValue:o.alert,"onUpdate:modelValue":n[3]||(n[3]=r=>o.alert=r)},{default:l(()=>[e(M,{class:"my_card"},{default:l(()=>[e(_,null,{default:l(()=>[le]),_:1}),e(_,{class:"q-pt-none"},{default:l(()=>[Q(" Revisa el archivo que se a Descargado(abierto) antes de firmar ")]),_:1}),e(_,null,{default:l(()=>[ie]),_:1}),e(E,{align:"right"},{default:l(()=>[$(e(h,{flat:"",label:"OK",color:"primary",onClick:o.sendImageSignature},null,8,["onClick"]),[[Y]])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ie=P(te,[["render",re],["__scopeId","data-v-75c20bc1"]]);export{Ie as default};
